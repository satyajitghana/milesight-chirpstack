{% extends "base.html" %}

{% block title %}Inkers Office IoT Dashboard{% endblock %}

{% block header %}
<header class="border-b border-slate-200 bg-white">
    <div class="max-w-7xl mx-auto px-6">
        <div class="flex h-16 items-center justify-between">
            <!-- Logo and Title -->
            <div class="flex items-center space-x-4">
                <div class="flex items-center space-x-3">
                    <img src="/static/assets/Observance Logo_Blue.png" alt="Inkers Logo" class="h-10 w-auto">
                    <div>
                        <h1 class="text-xl font-bold text-slate-900">Inkers Office IoT Dashboard</h1>
                        <p class="text-sm text-slate-500">Monitor and manage your office environment</p>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="flex items-center space-x-4">
                <!-- Auto-refresh toggle -->
                <div class="flex items-center space-x-2">
                    <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" id="auto-refresh-toggle" class="sr-only" checked>
                        <div class="relative">
                            <div class="toggle-bg block bg-slate-300 w-11 h-6 rounded-full transition-colors duration-200"></div>
                            <div class="toggle-dot absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition-transform duration-200 shadow-sm"></div>
                        </div>
                        <span class="text-sm text-slate-600">Auto-refresh</span>
                    </label>
                </div>

                <!-- Manual refresh button -->
                <button id="refresh-btn" class="btn btn-outline btn-sm">
                    <box-icon name="refresh" size="16px" class="mr-2"></box-icon>
                    Refresh
                </button>

                <!-- User menu -->
                <div class="flex items-center space-x-3">
                    <div class="flex items-center space-x-2">
                        <div class="w-8 h-8 bg-slate-100 rounded-full flex items-center justify-center">
                            <box-icon name="user" size="16px" color="#64748b"></box-icon>
                        </div>
                        <div class="hidden sm:block">
                            <div class="text-sm font-medium text-slate-900" id="user-name">Loading...</div>
                            <div class="text-xs text-slate-500" id="user-email">Loading...</div>
                        </div>
                    </div>
                    <button id="logout-btn" class="inline-flex items-center justify-center gap-2 px-3 py-2 text-sm font-medium text-red-600 bg-white border border-red-200 rounded-lg hover:bg-red-50 hover:border-red-300 transition-colors">
                        <box-icon name="log-out" size="16px" color="#dc2626"></box-icon>
                        <span>Logout</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</header>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-6 py-8">
    <!-- Stats Overview -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="stats-card">
            <div class="stats-title">
                <div class="icon-container devices">
                    <box-icon name="devices" color="white" size="20px"></box-icon>
                </div>
                <p class="stats-title-text">Devices</p>
                <div class="stats-percent">
                    <box-icon name="up-arrow" size="14px" color="#02972f"></box-icon>
                    100%
                </div>
            </div>
            <div class="stats-data">
                <p id="total-devices">0</p>
                <div class="stats-range">
                    <div class="fill devices" style="width: 100%"></div>
                </div>
            </div>
        </div>
        
        <div class="stats-card">
            <div class="stats-title">
                <div class="icon-container online">
                    <box-icon name="check-circle" color="white" size="20px"></box-icon>
                </div>
                <p class="stats-title-text">Online</p>
                <div class="stats-percent" id="online-percent">
                    <box-icon name="up-arrow" size="14px" color="#02972f"></box-icon>
                    0%
                </div>
            </div>
            <div class="stats-data">
                <p id="active-devices">0</p>
                <div class="stats-range">
                    <div class="fill online" id="online-fill" style="width: 0%"></div>
                </div>
            </div>
        </div>
        
        <div class="stats-card">
            <div class="stats-title">
                <div class="icon-container messages">
                    <box-icon name="message-dots" color="white" size="20px"></box-icon>
                </div>
                <p class="stats-title-text">Messages</p>
                <div class="stats-percent">
                    <box-icon name="up-arrow" size="14px" color="#02972f"></box-icon>
                    <span id="message-percent">0</span>k
                </div>
            </div>
            <div class="stats-data">
                <p id="total-messages">0</p>
                <div class="stats-range">
                    <div class="fill messages" id="message-fill" style="width: 75%"></div>
                </div>
            </div>
        </div>
        

        <!-- Animated Weather Card -->
        <div class="stats-card weather-card">
            <div class="weather-widget">
                <svg id="weather-back">
                    <radialGradient id="SVGID_1_" cx="0" cy="0" r="160" gradientUnits="userSpaceOnUse">
                        <stop offset="0" style="stop-color:#FFDE17;stop-opacity:0.7"/>
                        <stop offset="1" style="stop-color:#FFF200;stop-opacity:0"/>
                    </radialGradient>
                    <path id="weather-sunburst" style="fill:url(#SVGID_1_);" d="M0,159.85c-9.3,0-18.65-0.8-27.75-2.4L-3.9,20.7c2.55,0.45,5.3,0.45,7.85,0L28,157.4C18.8,159,9.4,159.85,0,159.85z M-80.4,138.3c-16.25-9.4-30.65-21.45-42.75-35.8L-17,13.1c1.7,2.05,3.7,3.7,6,5.05L-80.4,138.3z M80.65,138.2L11.05,18.1c2.25-1.3,4.3-3,6-5.05l106.3,89.25C111.25,116.7,96.9,128.8,80.65,138.2z M-151.25,54.15C-157.7,36.5-160.95,18-161-0.9l138.8-0.25c0,2.65,0.45,5.2,1.35,7.6L-151.25,54.15z M151.3,53.9L20.9,6.4c0.85-2.35,1.3-4.85,1.3-7.45c0-0.15,0-0.3,0-0.5H161l0-0.65l0,0.95C161,17.7,157.75,36.25,151.3,53.9z M-20.9-8.75l-130.5-47.25c6.4-17.7,15.8-34,27.9-48.45L-17.05-15.4C-18.75-13.4-20.05-11.15-20.9-8.75z M20.85-8.85c-0.9-2.4-2.2-4.65-3.9-6.65l106-89.6c12.15,14.4,21.65,30.65,28.15,48.3L20.85-8.85z M-11.1-20.4l-69.8-120c16.35-9.5,34.05-16,52.6-19.3L-4-23.05C-6.5-22.6-8.9-21.7-11.1-20.4z M11-20.45c-2.2-1.3-4.6-2.15-7.1-2.55l23.55-136.8c18.6,3.2,36.35,9.6,52.7,19L11-20.45z"/>
                </svg>
                <div id="weather-card" class="weather-inner">
                    <svg id="weather-inner">
                        <defs>
                            <path id="weather-leaf" d="M20.95,28.15l0.05-1.25c0,0,2.3-0.6,2.8-1.1c0.5-0.5,1.8-6.5,6-7.8c4.85-1.55,9.95-1,13.05-1.05c1.35,0-5,11.95-10.25,12.5c-3.75,0.4-8.6-2.55-8.6-2.55L20.95,28.15z"/>
                        </defs>
                        <circle id="weather-sun" style="fill: #F7ED47" cx="0" cy="0" r="25"/>
                        <g id="weather-layer3"></g>
                        <g id="weather-cloud3" class="weather-cloud"></g>
                        <g id="weather-layer2"></g>
                        <g id="weather-cloud2" class="weather-cloud"></g>
                        <g id="weather-layer1"></g>
                        <g id="weather-cloud1" class="weather-cloud"></g>
                    </svg>
                    <div class="weather-details">
                        <div class="weather-left">
                            <div class="weather-temp"><span id="weather-temp-value">20</span><span class="weather-unit">°C</span></div>
                            <div class="weather-feels">Feels like <span id="weather-feels-value">22</span>°C</div>
                        </div>
                        <div class="weather-right">
                            <div id="weather-location">Bangalore</div>
                            <div id="weather-summary">Loading...</div>
                        </div>
                    </div>
                    <div class="weather-metrics">
                        <div class="weather-metric">
                            <span class="weather-metric-label">Humidity</span>
                            <span id="weather-humidity" class="weather-metric-value">--</span>
                        </div>
                        <div class="weather-metric">
                            <span class="weather-metric-label">Pressure</span>
                            <span id="weather-pressure" class="weather-metric-value">--</span>
                        </div>
                        <div class="weather-metric">
                            <span class="weather-metric-label">UV Index</span>
                            <span id="weather-uv" class="weather-metric-value">--</span>
                        </div>
                        <div class="weather-metric">
                            <span class="weather-metric-label">Precip</span>
                            <span id="weather-precipitation" class="weather-metric-value">--</span>
                        </div>
                    </div>
                </div>
                <svg id="weather-outer"></svg>
            </div>
        </div>
    </div>

    <!-- Header with Last Update -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8">
        <div>
            <h2 class="text-3xl font-bold text-slate-900">Office Sensor Management</h2>
            <p class="text-slate-600 mt-1">Monitor and manage your office environment effortlessly</p>
        </div>
        <div class="flex items-center gap-4">
            <div class="flex items-center gap-3">
                <label class="text-sm font-medium text-slate-700 flex items-center gap-2">
                    <box-icon name="filter" size="16px" color="#475569"></box-icon>
                    Group by:
                </label>
                <div class="relative">
                    <select id="grouping-select" class="appearance-none bg-white border border-slate-300 rounded-lg px-4 py-2.5 pr-10 text-sm font-medium text-slate-700 shadow-sm hover:border-slate-400 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 focus:outline-none transition-colors cursor-pointer">
                        <option value="location">📍 Location</option>
                        <option value="function">⚙️ Function</option>
                        <option value="type">🔧 Type</option>
                        <option value="zone">🏢 Zone</option>
                        <option value="manufacturer">🏭 Manufacturer</option>
                        <option value="priority">⭐ Priority</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <box-icon name="chevron-down" size="16px" color="#64748b"></box-icon>
                    </div>
                </div>
            </div>
            <div class="text-sm text-slate-500">
                Last updated: <span id="last-update" class="font-medium">Loading...</span>
            </div>
            <div class="flex items-center space-x-4 text-sm">
                <div class="flex items-center gap-1">
                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                    <span class="text-slate-600">Online</span>
                </div>
                <div class="flex items-center gap-1">
                    <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                    <span class="text-slate-600">Recent</span>
                </div>
                <div class="flex items-center gap-1">
                    <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                    <span class="text-slate-600">Offline</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Devices Grid -->
    <div id="devices-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
        <!-- Device cards will be populated by JavaScript -->
        <div class="col-span-full flex items-center justify-center py-12">
            <div class="loading-spinner"></div>
            <span class="ml-3 text-slate-600">Loading devices...</span>
        </div>
    </div>
</div>
{% endblock %}

{% block footer %}
<footer class="border-t border-slate-200 bg-white">
    <div class="max-w-7xl mx-auto px-6 py-4">
        <div class="flex items-center justify-between text-sm text-slate-600">
            <div>
                <p>&copy; 2025 Inkers Office IoT Dashboard. Built with FastAPI and Tailwind CSS.</p>
            </div>
            <div class="flex items-center space-x-4">
                <span class="flex items-center gap-1">
                    <box-icon name="cog" size="14px" color="#64748b"></box-icon>
                    System: <span class="text-green-600 font-medium">Online</span>
                </span>
                <span class="flex items-center gap-1" id="mqtt-status">
                    <box-icon name="wifi" size="14px" color="#64748b"></box-icon>
                    MQTT: <span class="text-yellow-600 font-medium">Connecting...</span>
                </span>
            </div>
        </div>
    </div>
</footer>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', path='/js/dashboard.js') }}"></script>

<!-- Custom toggle styling -->
<style>
    /* Toggle switch styling */
    input:checked + div .toggle-bg {
        background-color: hsl(240 5.9% 10%) !important;
    }
    input:checked + div .toggle-dot {
        transform: translateX(20px);
    }
</style>
{% endblock %}
